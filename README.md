# üó≥Ô∏è Vota Ai - Sistema de Vota√ß√£o Eletr√¥nica

Sistema completo de vota√ß√£o eletr√¥nica desenvolvido para TCC, implementando todos os requisitos funcionais e regras de neg√≥cio necess√°rias para um processo eleitoral seguro e transparente.

## üìã √çndice

- [Vis√£o Geral](#-vis√£o-geral)
- [Instala√ß√£o e Execu√ß√£o](#-instala√ß√£o-e-execu√ß√£o)
- [Funcionalidades](#-funcionalidades)
- [API Endpoints](#-api-endpoints)
- [Exemplos de Uso](#-exemplos-de-uso)
- [Requisitos e Regras](#-requisitos-e-regras)
- [Tecnologias](#-tecnologias)

---

## üéØ Vis√£o Geral

O **Vota Ai** √© um sistema de vota√ß√£o eletr√¥nica completo que permite a realiza√ß√£o de elei√ß√µes de forma segura, transparente e eficiente. O sistema implementa dois n√≠veis de acesso (Administrador e Mes√°rio) com funcionalidades espec√≠ficas para cada papel.

### Caracter√≠sticas Principais
- ‚úÖ **Sistema Monol√≠tico** unificado para facilitar desenvolvimento e manuten√ß√£o
- ‚úÖ **Permissionamento Robusto** com JWT e roles
- ‚úÖ **Vota√ß√£o An√¥nima** garantindo privacidade do eleitor
- ‚úÖ **Credenciais de Uso √önico** para m√°xima seguran√ßa
- ‚úÖ **Interface RESTful** para integra√ß√£o com frontend
- ‚úÖ **Containeriza√ß√£o Docker** para f√°cil deploy

---

## üöÄ Instala√ß√£o e Execu√ß√£o

### Pr√©-requisitos
- Docker Desktop instalado e rodando
- Docker Compose v2.0+
- Portas 3000, 5432, 80 dispon√≠veis

### Execu√ß√£o R√°pida

```bash
# 1. Clone o reposit√≥rio
git clone <repository-url>
cd Vota-Ai-Urna

# 2. Subir todos os servi√ßos
docker-compose up --build

# 3. Aguardar inicializa√ß√£o (2-3 minutos)
# O sistema criar√° automaticamente:
# - Banco de dados PostgreSQL
# - Tabelas do Prisma
# - Usu√°rios padr√£o
# - Dados iniciais
```

### Execu√ß√£o em Background

```bash
# Subir em background
docker-compose up -d --build

# Verificar status
docker-compose ps

# Ver logs
docker-compose logs -f backend
```

### Parar o Sistema

```bash
# Parar containers
docker-compose down

# Parar e remover volumes (limpar dados)
docker-compose down -v
```

### üìã Containers do Sistema

| Container | Nome | Porta | Descri√ß√£o |
|-----------|------|-------|-----------|
| **PostgreSQL** | `vota-ai-postgres` | 5432 | Banco de dados principal |
| **Backend** | `vota-ai-backend` | 3000 | API NestJS |
| **Nginx** | `vota-ai-nginx` | 80/443 | Proxy reverso (opcional) |

### üåê URLs de Acesso

- **API Backend**: `http://localhost:3000`
- **Health Check**: `http://localhost:3000/health`
- **Banco de Dados**: `localhost:5432`
- **Proxy Nginx**: `http://localhost:80`

### üîê Credenciais Padr√£o

#### **Banco de Dados**
- **Host**: `localhost:5432`
- **Database**: `vota_ai_db`
- **User**: `votaai`
- **Password**: `votaai123`

#### **Sistema**
- **Admin**: `admin@vota-ai.com` / `admin123`
- **Mes√°rio**: `mesario01` / `mesario123`

---

## ‚öôÔ∏è Funcionalidades

### üîê Sistema de Autentica√ß√£o
- **JWT Tokens** com expira√ß√£o de 8 horas
- **Roles**: Admin e Mes√°rio com permiss√µes espec√≠ficas
- **Guards de Seguran√ßa** protegendo endpoints
- **Valida√ß√£o de Credenciais** em tempo real

### üë®‚Äçüíº Administrador
- **Criar Elei√ß√µes** com nome e descri√ß√£o
- **Gerenciar Chapas** para cada elei√ß√£o
- **Importar Eleitores** em lote (nome, matr√≠cula, curso)
- **Ativar/Encerrar Elei√ß√µes** controlando o processo
- **Visualizar Resultados** ap√≥s encerramento

### üë®‚Äç‚öñÔ∏è Mes√°rio
- **Buscar Eleitores** por matr√≠cula
- **Habilitar Eleitores** gerando credenciais √∫nicas
- **Verificar Status** da urna eletr√¥nica
- **Validar Credenciais** antes da vota√ß√£o

### üó≥Ô∏è Urna Eletr√¥nica
- **Valida√ß√£o de Credenciais** de uso √∫nico
- **Listagem de Chapas** dispon√≠veis
- **Confirma√ß√£o de Voto** an√¥nima
- **Invalida√ß√£o Autom√°tica** de credenciais

---

## üì° API Endpoints

### üîê Autentica√ß√£o
```http
POST /admin/login              # Login administrador
POST /mesario/login            # Login mes√°rio
```

### üë®‚Äçüíº Administrador (Protegido)
```http
POST /admin/eleicoes           # Criar elei√ß√£o
POST /admin/chapas             # Criar chapa
POST /admin/eleitores/importar # Importar eleitores
POST /admin/eleicoes/:id/ativar    # Ativar elei√ß√£o
POST /admin/eleicoes/:id/encerrar  # Encerrar elei√ß√£o
GET  /admin/eleicoes/:id/resultado # Ver resultados
```

### üë®‚Äç‚öñÔ∏è Mes√°rio (Protegido)
```http
GET  /mesario/eleitor/:matricula   # Buscar eleitor
POST /mesario/habilitar            # Habilitar eleitor
GET  /urna/status                  # Status da urna
```

### üó≥Ô∏è Urna (P√∫blico)
```http
POST /urna/validar-credencial     # Validar credencial
GET  /urna/chapas                # Listar chapas
POST /urna/confirmar             # Confirmar voto
```

### üîç Sistema
```http
GET  /health                     # Health check
POST /identidade/validar         # Validar identidade
```

---

## üì° Exemplos de Uso

### üîê Autentica√ß√£o

#### Login do Administrador
```bash
curl -X POST http://localhost:3000/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@vota-ai.com",
    "senha": "admin123"
  }'
```

#### Login do Mes√°rio
```bash
curl -X POST http://localhost:3000/mesario/login \
  -H "Content-Type: application/json" \
  -d '{
    "usuario": "mesario01",
    "senha": "mesario123"
  }'
```

### üë®‚Äçüíº Administrador

#### Criar Elei√ß√£o
```bash
curl -X POST http://localhost:3000/admin/eleicoes \
  -H "Authorization: Bearer SEU_TOKEN_ADMIN_AQUI" \
  -H "Content-Type: application/json" \
  -d '{
    "nome": "Elei√ß√£o para Representante Estudantil 2025",
    "descricao": "Elei√ß√£o para escolha do representante estudantil do curso de Ci√™ncia da Computa√ß√£o"
  }'
```

#### Importar Eleitores
```bash
curl -X POST http://localhost:3000/admin/eleitores/importar \
  -H "Authorization: Bearer SEU_TOKEN_ADMIN_AQUI" \
  -H "Content-Type: application/json" \
  -d '[
    {
      "nome": "Jo√£o Silva",
      "matricula": "2021001234",
      "curso": "Ci√™ncia da Computa√ß√£o"
    },
    {
      "nome": "Maria Santos",
      "matricula": "2021005678",
      "curso": "Engenharia de Software"
    }
  ]'
```

### üë®‚Äç‚öñÔ∏è Mes√°rio

#### Buscar Eleitor
```bash
curl -X GET http://localhost:3000/mesario/eleitor/2021001234 \
  -H "Authorization: Bearer SEU_TOKEN_MESARIO_AQUI"
```

#### Habilitar Eleitor
```bash
curl -X POST http://localhost:3000/mesario/habilitar \
  -H "Authorization: Bearer SEU_TOKEN_MESARIO_AQUI" \
  -H "Content-Type: application/json" \
  -d '{
    "matricula": "2021001234"
  }'
```

### üó≥Ô∏è Urna Eletr√¥nica

#### Validar Credencial
```bash
curl -X POST http://localhost:3000/urna/validar-credencial \
  -H "Content-Type: application/json" \
  -d '{
    "token": "abc123def456ghi789jkl012mno345pqr678stu901vwx234yz"
  }'
```

#### Confirmar Voto
```bash
curl -X POST http://localhost:3000/urna/confirmar \
  -H "Content-Type: application/json" \
  -d '{
    "eleicaoId": "eleicao-uuid",
    "chapaId": "chapa-uuid-1",
    "token": "abc123def456ghi789jkl012mno345pqr678stu901vwx234yz"
  }'
```

### üîÑ Fluxo Completo de Vota√ß√£o

#### 1. Administrador cria elei√ß√£o
```bash
# Login admin
ADMIN_TOKEN=$(curl -s -X POST http://localhost:3000/admin/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@vota-ai.com","senha":"admin123"}' | \
  jq -r '.token')

# Criar elei√ß√£o
ELEICAO_ID=$(curl -s -X POST http://localhost:3000/admin/eleicoes \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"nome":"Elei√ß√£o Teste","descricao":"Teste do sistema"}' | \
  jq -r '.eleicao.id')

# Ativar elei√ß√£o
curl -X POST http://localhost:3000/admin/eleicoes/$ELEICAO_ID/ativar \
  -H "Authorization: Bearer $ADMIN_TOKEN"
```

#### 2. Mes√°rio habilita eleitor
```bash
# Login mes√°rio
MESARIO_TOKEN=$(curl -s -X POST http://localhost:3000/mesario/login \
  -H "Content-Type: application/json" \
  -d '{"usuario":"mesario01","senha":"mesario123"}' | \
  jq -r '.token')

# Habilitar eleitor
CREDENCIAL=$(curl -s -X POST http://localhost:3000/mesario/habilitar \
  -H "Authorization: Bearer $MESARIO_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"matricula":"2021001234"}' | \
  jq -r '.credencial')
```

#### 3. Eleitor vota
```bash
# Validar credencial
curl -X POST http://localhost:3000/urna/validar-credencial \
  -H "Content-Type: application/json" \
  -d "{\"token\":\"$CREDENCIAL\"}"

# Confirmar voto
curl -X POST http://localhost:3000/urna/confirmar \
  -H "Content-Type: application/json" \
  -d "{\"eleicaoId\":\"$ELEICAO_ID\",\"chapaId\":\"CHAPA_ID\",\"token\":\"$CREDENCIAL\"}"
```

---

## üìã Requisitos e Regras

### ‚úÖ Requisitos Funcionais Implementados

| RF | Descri√ß√£o | Status |
|----|-----------|--------|
| **RF01** | Sistema deve permitir login de administrador | ‚úÖ |
| **RF02** | Sistema deve permitir login de mes√°rio | ‚úÖ |
| **RF03** | Administrador deve criar elei√ß√µes | ‚úÖ |
| **RF04** | Administrador deve criar chapas | ‚úÖ |
| **RF05** | Administrador deve importar eleitores | ‚úÖ |
| **RF06** | Administrador deve ativar elei√ß√µes | ‚úÖ |
| **RF07** | Administrador deve encerrar elei√ß√µes | ‚úÖ |
| **RF08** | Administrador deve visualizar resultados | ‚úÖ |
| **RF09** | Mes√°rio deve buscar eleitores | ‚úÖ |
| **RF10** | Mes√°rio deve habilitar eleitores | ‚úÖ |
| **RF11** | Sistema deve validar credenciais | ‚úÖ |
| **RF12** | Sistema deve listar chapas | ‚úÖ |
| **RF13** | Sistema deve confirmar votos | ‚úÖ |
| **RF14** | Sistema deve validar identidade | ‚úÖ |
| **RF15** | Sistema deve fornecer health check | ‚úÖ |

### ‚úÖ Regras de Neg√≥cio Implementadas

| RN | Descri√ß√£o | Status |
|----|-----------|--------|
| **RN01** | Apenas administradores podem criar elei√ß√µes | ‚úÖ |
| **RN02** | Elei√ß√£o deve ter lista de eleitores | ‚úÖ |
| **RN03** | Apenas administradores podem ativar elei√ß√µes | ‚úÖ |
| **RN04** | Resultados s√≥ ap√≥s elei√ß√£o encerrada | ‚úÖ |
| **RN05** | Apenas eleitores da lista podem ser habilitados | ‚úÖ |
| **RN06** | Eleitor n√£o pode votar duas vezes | ‚úÖ |
| **RN07** | Credencial deve ser de uso √∫nico | ‚úÖ |
| **RN08** | Mes√°rio deve verificar habilita√ß√£o | ‚úÖ |
| **RN09** | Credencial deve ser v√°lida para vota√ß√£o | ‚úÖ |
| **RN10** | Voto deve ser an√¥nimo | ‚úÖ |
| **RN11** | Sistema deve registrar timestamp | ‚úÖ |
| **RN12** | Sistema deve validar dados | ‚úÖ |
| **RN13** | Sistema n√£o deve armazenar dados identificadores | ‚úÖ |

---

## üóÑÔ∏è Banco de Dados

### Schema Principal

```sql
-- Elei√ß√µes
Eleicao {
  id: String (UUID)
  nome: String
  descricao: String?
  ativa: Boolean
  status: String (Criada/Ativa/Encerrada)
  createdAt: DateTime
  updatedAt: DateTime
}

-- Chapas
Chapa {
  id: String (UUID)
  nome: String
  eleicaoId: String (FK)
}

-- Eleitores
Eleitor {
  id: String (UUID)
  nome: String
  matricula: String (Unique)
  curso: String
  eleicaoId: String (FK)
  jaVotou: Boolean
}

-- Credenciais
Credencial {
  id: String (UUID)
  eleitorId: String (FK)
  eleicaoId: String (FK)
  token: String (Unique)
  usada: Boolean
}

-- Votos
Voto {
  id: String (UUID)
  eleicaoId: String (FK)
  chapaId: String (FK)
  timestamp: DateTime
}

-- Usu√°rios do Sistema
Administrador {
  id: String (UUID)
  nome: String
  email: String (Unique)
  senha: String
}

Mesario {
  id: String (UUID)
  nome: String
  usuario: String (Unique)
  senha: String
}
```

---

## üîê Sistema de Permissionamento

### Estrutura de Usu√°rios
```typescript
// Administrador
{
  id: string
  nome: string
  email: string (√∫nico)
  senha: string
  role: 'admin'
}

// Mes√°rio
{
  id: string
  nome: string
  usuario: string (√∫nico)
  senha: string
  role: 'mesario'
}
```

### Fluxo de Autentica√ß√£o
```
1. Login ‚Üí Valida√ß√£o de credenciais
2. Gera√ß√£o de JWT com role
3. Token enviado no header Authorization
4. Guards validam token e role
5. Acesso liberado ou negado
```

### Matriz de Permiss√µes

| Funcionalidade | Admin | Mes√°rio | P√∫blico |
|----------------|-------|---------|---------|
| **Criar Elei√ß√£o** | ‚úÖ | ‚ùå | ‚ùå |
| **Criar Chapa** | ‚úÖ | ‚ùå | ‚ùå |
| **Importar Eleitores** | ‚úÖ | ‚ùå | ‚ùå |
| **Ativar Elei√ß√£o** | ‚úÖ | ‚ùå | ‚ùå |
| **Encerrar Elei√ß√£o** | ‚úÖ | ‚ùå | ‚ùå |
| **Ver Resultados** | ‚úÖ | ‚ùå | ‚ùå |
| **Buscar Eleitor** | ‚ùå | ‚úÖ | ‚ùå |
| **Habilitar Eleitor** | ‚ùå | ‚úÖ | ‚ùå |
| **Status da Urna** | ‚ùå | ‚úÖ | ‚ùå |
| **Validar Credencial** | ‚ùå | ‚ùå | ‚úÖ |
| **Listar Chapas** | ‚ùå | ‚ùå | ‚úÖ |
| **Confirmar Voto** | ‚ùå | ‚ùå | ‚úÖ |

---

## üê≥ Docker

### Comandos Principais

```bash
# Subir sistema completo
docker-compose up --build

# Em background
docker-compose up -d --build

# Verificar status
docker-compose ps

# Ver logs
docker-compose logs -f

# Parar sistema
docker-compose down

# Parar e limpar dados
docker-compose down -v
```

### Desenvolvimento

```bash
# Usar configura√ß√£o de desenvolvimento
docker-compose -f docker-compose.dev.yml up --build
```

### Monitoramento

```bash
# Health check
curl http://localhost:3000/health

# Estat√≠sticas dos containers
docker stats

# Logs espec√≠ficos
docker-compose logs backend
docker-compose logs postgres
```

---

## üß™ Testes

### Health Check
```bash
curl http://localhost:3000/health
```

### Teste de Login
```bash
# Admin
curl -X POST http://localhost:3000/admin/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@vota-ai.com","senha":"admin123"}'

# Mes√°rio
curl -X POST http://localhost:3000/mesario/login \
  -H "Content-Type: application/json" \
  -d '{"usuario":"mesario01","senha":"mesario123"}'
```

### Teste de Banco
```bash
# Conectar ao PostgreSQL
docker exec -it vota-ai-postgres psql -U votaai -d vota_ai_db

# Listar tabelas
\dt

# Verificar dados
SELECT * FROM "Administrador";
SELECT * FROM "Mesario";
```

---

## üõ†Ô∏è Tecnologias

### Backend
- **NestJS** - Framework Node.js
- **TypeScript** - Linguagem principal
- **Prisma** - ORM para banco de dados
- **JWT** - Autentica√ß√£o e autoriza√ß√£o
- **Passport** - Estrat√©gias de autentica√ß√£o

### Banco de Dados
- **PostgreSQL** - Banco relacional
- **Prisma Client** - Acesso aos dados
- **Migrations** - Controle de vers√£o do schema

### Containeriza√ß√£o
- **Docker** - Containeriza√ß√£o
- **Docker Compose** - Orquestra√ß√£o
- **Multi-stage Build** - Otimiza√ß√£o de imagens

### Desenvolvimento
- **ESLint** - Linting de c√≥digo
- **Prettier** - Formata√ß√£o
- **Git** - Controle de vers√£o

---

## üìû Suporte

### Logs Importantes
```bash
# Logs de inicializa√ß√£o
docker-compose logs backend | head -50

# Logs de erro
docker-compose logs backend | grep -i error

# Logs do banco
docker-compose logs postgres | tail -20
```

### Informa√ß√µes para Suporte
```bash
# Vers√£o do Docker
docker --version

# Status dos containers
docker-compose ps

# Configura√ß√£o do sistema
docker-compose config
```

---

**üéâ Sistema Vota Ai est√° pronto para uso!**

Para mais informa√ß√µes t√©cnicas, consulte os arquivos de documenta√ß√£o espec√≠ficos no projeto.